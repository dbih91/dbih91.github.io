<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Julia Plants</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&display=swap" rel="stylesheet">
  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      font-size: 24px;
    }

    body {
      padding: 24px;
    }

    #canvas {
      display: block;
      width: 100%;
      max-width: 1166px;
      margin-inline: auto;
      outline: 4px solid gray;
    }

    .inputs {
      max-width: 1166px;
      margin-inline: auto;
      padding-block: 24px;
      display: flex;
      flex-flow: column;
      gap: 16px;
    }

    .inputs label {
      display: flex;
      flex-flow: column;
      gap: 8px;
    }

    .inputs span {
      min-width: 100px;
    }

    #icons {
      display: none;
    }
  </style>
</head>
<body>
<div id="icons">
  <svg id="waterDrop" xmlns="http://www.w3.org/2000/svg" height="128px" viewBox="0 -960 960 960" width="128px"><path d="M491-200q12-1 20.5-9.5T520-230q0-14-9-22.5t-23-7.5q-41 3-87-22.5T343-375q-2-11-10.5-18t-19.5-7q-14 0-23 10.5t-6 24.5q17 91 80 130t127 35Zm-239.5 26Q160-268 160-408q0-100 79.5-217.5T480-880q161 137 240.5 254.5T800-408q0 140-91.5 234T480-80q-137 0-228.5-94ZM652-230.5Q720-301 720-408q0-73-60.5-165T480-774Q361-665 300.5-573T240-408q0 107 68 177.5T480-160q104 0 172-70.5ZM480-480Z"/></svg>
  <svg id="sun" xmlns="http://www.w3.org/2000/svg" height="128px" viewBox="0 -960 960 960" width="128px"><path d="M440-760v-160h80v160h-80Zm266 110-55-55 112-115 56 57-113 113Zm54 210v-80h160v80H760ZM440-40v-160h80v160h-80ZM254-652 140-763l57-56 113 113-56 54Zm508 512L651-255l54-54 114 110-57 59ZM40-440v-80h160v80H40Zm157 300-56-57 112-112 29 27 29 28-114 114Zm113-170q-70-70-70-170t70-170q70-70 170-70t170 70q70 70 70 170t-70 170q-70 70-170 70t-170-70Zm283-57q47-47 47-113t-47-113q-47-47-113-47t-113 47q-47 47-47 113t47 113q47 47 113 47t113-47ZM480-480Z"/></svg>
  <svg id="pet" xmlns="http://www.w3.org/2000/svg" height="128px" viewBox="0 -960 960 960" width="128px"><path d="M180-475q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29Zm109-189q-29-29-29-71t29-71q29-29 71-29t71 29q29 29 29 71t-29 71q-29 29-71 29t-71-29Zm240 0q-29-29-29-71t29-71q29-29 71-29t71 29q29 29 29 71t-29 71q-29 29-71 29t-71-29Zm251 189q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29ZM266-75q-45 0-75.5-34.5T160-191q0-52 35.5-91t70.5-77q29-31 50-67.5t50-68.5q22-26 51-43t63-17q34 0 63 16t51 42q28 32 49.5 69t50.5 69q35 38 70.5 77t35.5 91q0 47-30.5 81.5T694-75q-54 0-107-9t-107-9q-54 0-107 9t-107 9Z"/></svg>
  <svg id="dislike" xmlns="http://www.w3.org/2000/svg" height="128px" viewBox="0 -960 960 960" width="128px"><path d="M481-83Q347-218 267.5-301t-121-138q-41.5-55-54-94T80-620q0-92 64-156t156-64q45 0 87 16.5t75 47.5l-62 216h120l-34 335 114-375H480l71-212q25-14 52.5-21t56.5-7q92 0 156 64t64 156q0 48-13 88t-55 95.5q-42 55.5-121 138T481-83Zm-71-186 21-211H294l75-263q-16-8-33.5-12.5T300-760q-58 0-99 41t-41 99q0 31 11.5 62t40 70.5q28.5 39.5 77 92T410-269Zm188-48q111-113 156.5-180T800-620q0-58-41-99t-99-41q-11 0-22 1.5t-22 5.5l-24 73h116L598-317Zm110-363ZM294-480Z"/></svg>
  <svg id="like" xmlns="http://www.w3.org/2000/svg" height="128px" viewBox="0 -960 960 960" width="128px"><path d="m480-120-58-52q-101-91-167-157T150-447.5Q111-500 95.5-544T80-634q0-94 63-157t157-63q52 0 99 22t81 62q34-40 81-62t99-22q94 0 157 63t63 157q0 46-15.5 90T810-447.5Q771-395 705-329T538-172l-58 52Zm0-108q96-86 158-147.5t98-107q36-45.5 50-81t14-70.5q0-60-40-100t-100-40q-47 0-87 26.5T518-680h-76q-15-41-55-67.5T300-774q-60 0-100 40t-40 100q0 35 14 70.5t50 81q36 45.5 98 107T480-228Zm0-273Z"/></svg>
</div>

<canvas id="canvas" width="1166" height="818"></canvas>

<div class="inputs">
  <label>
    <span> Название </span>
    <textarea id="inputName">Картошечка
Вкусная</textarea>
  </label>

  <label>
    <span> Вода </span>
    <input id="inputWater" type="range" min="0" max="6" value="3">
  </label>

  <label>
    <span> Свет </span>
    <input id="inputLight" type="range" min="0" max="6" value="3">
  </label>


  <label>
    <span> Опасно для животных </span>
    <input id="petDangerInput" type="checkbox">
  </label>


  <label>
    <span> Дополнительно </span>
    <textarea id="inputExtra"></textarea>
  </label>

  <div>
    <a id="download" href="">Скачать</a>
  </div>
</div>
<script async>
  const createImageFromElement = (elementId) => {
    const svgElement = document.getElementById(elementId);
    const width = svgElement.width.baseVal.value;
    const height = svgElement.height.baseVal.value;
    const image = new Image();
    const svgString = new XMLSerializer().serializeToString(svgElement);
    image.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgString);

    return {
      image,
      width,
      height,
    };
  }

  const waterDrop = createImageFromElement('waterDrop')
  const sun = createImageFromElement('sun')
  const pet = createImageFromElement('pet')
  const dislike = createImageFromElement('dislike')
  const like = createImageFromElement('like')

  const canvas = document.getElementById('canvas')
  const inputName = document.getElementById('inputName')
  const inputWater = document.getElementById('inputWater')
  const inputLight = document.getElementById('inputLight')
  const petDangerInput = document.getElementById('petDangerInput')
  const inputExtra = document.getElementById('inputExtra')
  const download = document.getElementById('download')

  const context = canvas.getContext('2d')

  const padding = 32
  const fontSize = 48
  const fontNameSize = 192
  const fontNameSizeMedium = 128
  const fontNameSizeSmall = 96

  context.font = `bold ${ fontSize }px "Caveat"`

  const render = () => {
    const [partOne, partTwo, partThree] = inputExtra.value.split('\n').map((each) => each.trim())

    if (partThree) {
      canvas.height = 818
    } else if (partTwo) {
      canvas.height = 818 - fontNameSizeSmall
    } else if (partOne) {
      canvas.height = 818 - fontNameSizeSmall * 2
    } else {
      canvas.height = 818 - fontNameSizeSmall * 3
    }

    const width = canvas.width;
    const height = 818;

    context.fillStyle = 'white'
    context.fillRect(0, 0, width, height);

    context.fillStyle = 'black'

    // Рисуем имя
    const hasNewLine = inputName.value.includes('\n')

    context.textAlign = 'center'
    context.textBaseline = 'middle'

    if (hasNewLine && !inputName.value.endsWith('\n')) {
      const [partOne, partTwo] = inputName.value.split('\n')

      context.font = `bold ${ fontNameSizeMedium }px "Caveat"`
      context.fillText(`${ partOne.trim() }`, width / 2, fontNameSizeMedium / 2 + padding, width - padding * 2)
      context.fillText(`${ partTwo.trim() }`, width / 2, fontNameSizeMedium / 2 + padding + fontNameSizeMedium, width - padding * 2)
    } else {
      context.font = `bold ${ fontNameSize }px "Caveat"`
      context.fillText(`${ inputName.value.trim() || 'Введите имя' }`, width / 2, fontNameSize / 2 + padding * 2, width - padding * 2)
    }

    // Рисуем капельки

    context.fillStyle = '#FFFFFFA0'
    for (const index in Array.from({ length: 3 })) {
      context.drawImage(waterDrop.image, waterDrop.width * index + waterDrop.width * 0.25, height / 2 - waterDrop.height / 2, waterDrop.width, waterDrop.height)
    }
    context.fillRect(inputWater.value * (waterDrop.width / 2) + waterDrop.width * 0.25, height / 2 - waterDrop.height / 2, waterDrop.width * 3, waterDrop.height)

    // Рисуем солнешки
    for (const index in Array.from({ length: 3 })) {
      context.drawImage(sun.image, sun.width * index + sun.width * 5.75, height / 2 - sun.height / 2, sun.width, sun.height)
    }
    context.fillRect(inputLight.value * (sun.width / 2) + sun.width * 5.75, height / 2 - sun.height / 2, sun.width * 3, sun.height)

    // Рисуем питомцев
    context.drawImage(pet.image, pet.width * 3.5, height / 2 - pet.height / 2, pet.width, pet.height)
    context.drawImage(petDangerInput.checked ? dislike.image : like.image, like.width * 4.5, height / 2 - like.height / 2, like.width, like.height)

    if (inputExtra.value.trim()) {
      const [partOne, partTwo, partThree] = inputExtra.value.split('\n').map((each) => each.trim())

      context.fillStyle = 'black'
      context.font = `bold ${ fontNameSizeSmall }px "Caveat"`

      if (partThree) {
        context.fillText(`${ partThree }`, width / 2, height - (fontNameSizeSmall / 2 + padding), width - padding * 2)
      }

      if (partTwo) {
        context.fillText(`${ partTwo }`, width / 2, height - (fontNameSizeSmall / 2 + padding + fontNameSizeSmall), width - padding * 2)
      }

      context.fillText(`${ partOne }`, width / 2, height - (fontNameSizeSmall / 2 + padding + fontNameSizeSmall * 2), width - padding * 2)
    }

    setTimeout(() => {
      download.download = 'PlantBadge.png';
      download.href = canvas.toDataURL('image/png');
      download.dataset.downloadurl = ['image/png', download.download, download.href].join(':')
    }, 100)
  }

  [inputName, inputWater, inputLight, petDangerInput, inputExtra].forEach(each => each.addEventListener('input', render))

  setTimeout(render, 250)
</script>
</body>
</html>